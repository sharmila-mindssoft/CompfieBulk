var Custombox=function(e,t,i){"use strict";var n={create:document.createElement,settings:[],overlay:[],wrapper:[],container:[],modal:[],content:[],inline:[],size:[],close:[],open:[],scroll:[],item:-1},s={target:null,id:null,cache:!1,escKey:!0,zIndex:1e4,overlay:!0,overlayColor:"#000",overlayOpacity:.8,overlayClose:!0,overlaySpeed:300,overlayEffect:"auto",width:null,effect:"fadein",position:"center, center",animation:null,speed:500,open:null,complete:null,close:null},o={oldIE:navigator.appVersion.indexOf("MSIE 8.")>-1||navigator.appVersion.indexOf("MSIE 9.")>-1,oldMobile:/(iPhone|iPad|iPod)\sOS\s6/.test(navigator.userAgent),overlay:{perspective:["letmein","makeway","slip"],together:["corner","slidetogether","scale","door","push","contentscale","simplegenie","slit","slip"]},modal:{position:["slide","flip","rotate"]}},a={init:function(){this.merge().built().check().binds()},merge:function(){return n.settings.push(r.extend({},s,n.options)),delete n.options,n.item=n.settings.length-1,"auto"===n.settings[n.item].overlayEffect&&(n.settings[n.item].overlayEffect=n.settings[n.item].effect),this},built:function(){var s=r.zIndex();if(i.classList.add("custombox-open"),i.classList.add("custombox-open-"+n.settings[n.item].overlayEffect),o.overlay.perspective.indexOf(n.settings[n.item].overlayEffect)>-1&&(n.scroll.push(i&&i.scrollTop||t.body&&t.body.scrollTop||0),i.classList.add("custombox-perspective"),e.scrollTo(0,0)),!n.item){for(n.main=n.create.call(t,"div");t.body.firstChild;)n.main.appendChild(t.body.firstChild);t.body.appendChild(n.main)}return"push"===n.settings[n.item].overlayEffect&&(n.main.style.transitionDuration=n.settings[n.item].speed+"ms"),n.main.classList.add("custombox-container"),n.main.classList.add("custombox-container-"+n.settings[n.item].overlayEffect),n.settings[n.item].overlay?(n.overlay.push(n.create.call(t,"div")),n.overlay[n.item].classList.add("custombox-overlay"),n.overlay[n.item].classList.add("custombox-overlay-"+n.settings[n.item].overlayEffect),n.overlay[n.item].style.zIndex=s+2,n.overlay[n.item].style.backgroundColor=n.settings[n.item].overlayColor,n.overlay[n.item].dataset.custombox=n.settings[n.item].id,o.overlay.perspective.indexOf(n.settings[n.item].overlayEffect)>-1||o.overlay.together.indexOf(n.settings[n.item].overlayEffect)>-1?n.overlay[n.item].style.opacity=n.settings[n.item].overlayOpacity:n.overlay[n.item].classList.add("custombox-overlay-default"),n.overlay[n.item].style.transitionDuration=o.overlay.together.indexOf(n.settings[n.item].overlayEffect)>-1?n.settings[n.item].speed+"ms":n.settings[n.item].overlaySpeed+"ms",t.body.insertBefore(n.overlay[n.item],t.body.lastChild.nextSibling)):n.overlay.push(null),n.wrapper.push(n.create.call(t,"div")),n.wrapper[n.item].classList.add("custombox-modal-wrapper"),n.wrapper[n.item].classList.add("custombox-modal-wrapper-"+n.settings[n.item].effect),n.wrapper[n.item].style.zIndex=s+3,n.wrapper[n.item].dataset.custombox=n.settings[n.item].id,t.body.insertBefore(n.wrapper[n.item],t.body.lastChild.nextSibling),n.container.push(n.create.call(t,"div")),n.container[n.item].classList.add("custombox-modal-container"),n.container[n.item].classList.add("custombox-modal-container-"+n.settings[n.item].effect),n.container[n.item].style.zIndex=s+4,o.modal.position.indexOf(n.settings[n.item].effect)>-1&&(n.settings[n.item].animation=null!==n.settings[n.item].animation?n.settings[n.item].animation.indexOf(",")>-1?n.settings[n.item].animation.split(","):[n.settings[n.item].animation]:"slide"===n.settings[n.item].effect?["top"]:"flip"===n.settings[n.item].effect?["horizontal"]:["bottom"]),n.modal.push(n.create.call(t,"div")),n.modal[n.item].classList.add("custombox-modal"),n.modal[n.item].classList.add("custombox-modal-"+n.settings[n.item].effect+(o.modal.position.indexOf(n.settings[n.item].effect)>-1?"-"+n.settings[n.item].animation[0].trim():"")),n.modal[n.item].style.transitionDuration=n.settings[n.item].speed+"ms",n.modal[n.item].style.zIndex=s+4,n.wrapper[n.item].appendChild(n.container[n.item]).appendChild(n.modal[n.item]),this},check:function(){if("function"==typeof n.settings[n.item].open&&n.settings[n.item].open.call(),t.createEvent){var e=t.createEvent("Event");e.initEvent("custombox.open",!0,!0),t.dispatchEvent(e)}return n.settings[n.item].position.indexOf(",")>-1?(n.settings[n.item].position=n.settings[n.item].position.split(","),"#"===n.settings[n.item].target.charAt(0)||"."===n.settings[n.item].target.charAt(0)&&"/"!==n.settings[n.item].target.charAt(1)?t.querySelector(n.settings[n.item].target)?(n.inline.push(n.create.call(t,"div")),n.content.push(t.querySelector(n.settings[n.item].target)),n.content[n.item].style.display="block",n.content[n.item].parentNode.insertBefore(n.inline[n.item],n.content[n.item]),this.size().open()):this.error():this.ajax()):this.error(),this},ajax:function(){var e=this,i=new XMLHttpRequest,s=n.create.call(t,"div");i.onreadystatechange=function(){4===i.readyState&&(200===i.status?(s.innerHTML=i.responseText,n.content.push(s),n.content[n.item].style.display="block",o.oldIE?n.content[n.item].style.styleFloat="left":n.content[n.item].style.cssFloat="left",n.container[n.item].appendChild(n.content[n.item]),e.size().open()):e.error())},i.open("GET",n.settings[n.item].target+(n.settings[n.item].cache?"":"?_="+Date.now()),!0),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.send(null)},size:function(){o.oldIE&&(e.innerHeight=i.clientHeight);var t=n.content[n.item].offsetWidth;if(n.inline[n.item]||(o.oldIE?n.content[n.item].style.styleFloat="none":n.content[n.item].style.cssFloat="none"),isNaN(n.settings[n.item].width)||null===n.settings[n.item].width||(t=parseInt(n.settings[n.item].width,0)),n.size.push(t),n.size[n.item]+60>=e.innerWidth){n.container[n.item].style.width="auto",n.container[n.item].style.margin="5%",n.wrapper[n.item].style.width=e.innerWidth+"px";for(var s=0,a=n.content[n.item].querySelectorAll(":scope > *"),r=a.length;r>s;s++)a[s].offsetWidth>e.innerWidth&&(a[s].style.width="auto")}else{switch(n.settings[n.item].position[0].trim()){case"left":n.container[n.item].style.marginLeft=0;break;case"right":n.container[n.item].style.marginRight=0}n.container[n.item].style.width=n.size[n.item]+"px"}if(n.content[n.item].style.width="auto",n.modal[n.item].appendChild(n.content[n.item]),n.content[n.item].offsetHeight>=e.innerHeight)n.container[n.item].style.marginTop="5%",n.container[n.item].style.marginBottom="5%";else{var l;switch(n.settings[n.item].position[1].trim()){case"top":l=0;break;case"bottom":l=e.innerHeight-n.content[n.item].offsetHeight+"px";break;default:l=e.innerHeight/2-n.content[n.item].offsetHeight/2+"px"}n.container[n.item].style.marginTop=l}return this},open:function(){if(n.settings[n.item].overlay)if(o.overlay.perspective.indexOf(n.settings[n.item].overlayEffect)>-1||o.overlay.together.indexOf(n.settings[n.item].overlayEffect)>-1?n.overlay[n.item].classList.add("custombox-overlay-open"):n.overlay[n.item].style.opacity=n.settings[n.item].overlayOpacity,n.main.classList.add("custombox-container-open"),o.overlay.together.indexOf(n.settings[n.item].overlayEffect)>-1||o.oldIE)n.wrapper[n.item].classList.add("custombox-modal-open");else{var e=function(){n.overlay[n.item].removeEventListener("transitionend",e),n.wrapper[n.item].classList.add("custombox-modal-open")};n.overlay[n.item].addEventListener("transitionend",e,!1)}else n.wrapper[n.item].classList.add("custombox-modal-open"),n.main.classList.add("custombox-container-open");return this},binds:function(){var i=this;n.settings[n.item].escKey&&(t.onkeydown=function(t){27===(t=t||e.event).keyCode&&i.close()}),n.settings[n.item].overlayClose&&n.wrapper[n.item].addEventListener("click",function(e){e.target===n.wrapper[n.item]&&i.close()},!1),e.addEventListener("onorientationchange"in e?"orientationchange":"resize",function(){i.responsive()},!1);var s=function(){if(!n.inline[n.item])for(var e=0,i=n.modal[n.item].getElementsByTagName("script"),s=i.length;s>e;e++)new Function(i[e].text)();if(n.settings[n.item]&&"function"==typeof n.settings[n.item].complete&&n.settings[n.item].complete.call(),t.createEvent){var o=t.createEvent("Event");o.initEvent("custombox.complete",!0,!0),t.dispatchEvent(o)}},a=function(){s(),n.modal[n.item].removeEventListener("transitionend",a)};o.oldIE||o.oldMobile?setTimeout(function(){s()},n.settings[n.item].overlaySpeed):"slit"!==n.settings[n.item].effect?n.modal[n.item].addEventListener("transitionend",a,!1):n.modal[n.item].addEventListener("animationend",a,!1)},close:function(s){var a;if(void 0!==n.settings){if("first"===s)a=0;else if(void 0!==s){for(var r=0,l=n.settings.length;l>r;r++)if(n.settings[r].id==s){a=r;break}void 0===a&&(a=n.settings.length-1)}else a=n.settings.length-1;var c=function(){if(i.classList.remove("custombox-open-"+n.settings[a].overlayEffect),n.settings[a].overlay&&(n.overlay[a].classList.add("custombox-overlay-close"),n.overlay[a].style.opacity&&(n.overlay[a].style.opacity=0),n.overlay[a].classList.remove("custombox-overlay-open"),n.main.classList.remove("custombox-container-open")),o.oldIE||o.oldMobile||!n.overlay[a])m();else{var e=function(){void 0!==n.overlay[a]&&(n.overlay[a].removeEventListener("transitionend",e),m())};n.overlay[a].addEventListener("transitionend",e,!1)}},m=function(){if(1===n.settings.length&&(i.classList.remove("custombox-perspective"),i.classList.remove("custombox-open"),void 0!==n.scroll[a]&&e.scrollTo(0,n.scroll[a])),i.classList.remove("custombox-open-"+n.settings[a].overlayEffect),n.inline[a]&&(o.oldIE?(n.content[a].style.removeAttribute("width"),n.content[a].style.removeAttribute("display")):(n.content[a].style.removeProperty("width"),n.content[a].style.removeProperty("display")),n.inline[a].parentNode.replaceChild(n.content[a],n.inline[a])),n.main.classList.remove("custombox-container-"+n.settings[a].overlayEffect),n.wrapper[a].parentNode.removeChild(n.wrapper[a]),n.settings[a].overlay&&n.overlay[a].parentNode.removeChild(n.overlay[a]),"function"==typeof n.settings[a].close&&n.settings[a].close.call(),t.createEvent){var s=t.createEvent("Event");s.initEvent("custombox.close",!0,!0),t.dispatchEvent(s)}if(1===n.settings.length){for(var r=t.querySelectorAll(".custombox-container > *"),l=0,c=r.length;c>l;l++)document.body.insertBefore(r[l],n.main);n.main.parentNode&&n.main.parentNode.removeChild(n.main)}n.wrapper.splice(a,1),n.inline[a]&&n.inline.splice(a,1),n.content.splice(a,1),n.container.splice(a,1),n.modal.splice(a,1),n.overlay.splice(a,1),n.size.splice(a,1),n.settings.splice(a,1),n.scroll.splice(a,1)};if(void 0!==n.settings[a])if(o.modal.position.indexOf(n.settings[a].effect)>-1&&n.settings[a].animation.length>1&&(n.modal[a].classList.remove("custombox-modal-"+n.settings[a].effect+"-"+n.settings[a].animation[0]),n.modal[a].classList.add("custombox-modal-"+n.settings[a].effect+"-"+n.settings[a].animation[1].trim())),n.wrapper[a].classList.remove("custombox-modal-open"),o.oldIE||o.oldMobile||o.overlay.together.indexOf(n.settings[a].overlayEffect)>-1)c();else{var d=function(){n.wrapper[a].removeEventListener("transitionend",d),c()};n.wrapper[a].addEventListener("transitionend",d,!1)}}},responsive:function(){o.oldIE&&(e.innerHeight=i.clientHeight);for(var t,s=0,a=n.container.length;a>s;s++){if(n.size[s]+60>=e.innerWidth)n.container[s].style.width="auto",n.container[s].style.marginLeft="5%",n.container[s].style.marginRight="5%",n.wrapper[n.item].style.width=e.innerWidth+"px";else{switch(n.settings[n.item].position[0].trim()){case"left":n.container[s].style.marginLeft=0;break;case"right":n.container[s].style.marginRight=0;break;default:n.container[s].style.marginLeft="auto",n.container[s].style.marginRight="auto"}n.container[s].style.width=n.size[s]+"px",n.wrapper[n.item].style.width="auto"}if(n.content[s].offsetHeight>=e.innerHeight)n.container[s].style.marginTop="5%",n.container[s].style.marginBottom="5%";else{switch(n.settings[n.item].position[1]){case"top":t=0;break;case"bottom":t=e.innerHeight-n.content[s].offsetHeight+"px";break;default:t=e.innerHeight/2-n.content[s].offsetHeight/2+"px"}n.container[s].style.marginTop=t}}},error:function(){alert("Error to load this target: "+n.settings[n.item].target)}},r={zIndex:function(){e.getComputedStyle||(e.getComputedStyle=function(e){return this.el=e,this.getPropertyValue=function(t){var i=/(\-([a-z]){1})/g;return"float"==t&&(t="styleFloat"),i.test(t)&&(t=t.replace(i,function(){return arguments[2].toUpperCase()})),e.currentStyle[t]?e.currentStyle[t]:null},this});var t=0;if(isNaN(n.settings[n.item].zIndex))for(var i=0,s=document.getElementsByTagName("*"),o=s.length;o>i;i+=1){var a=e.getComputedStyle(s[i]).getPropertyValue("z-index");a&&((a=+a)>t&&(t=a))}else t=n.settings[n.item].zIndex;return t},extend:function(){for(var e=1,t=arguments.length;t>e;e++)for(var i in arguments[e])arguments[e].hasOwnProperty(i)&&(arguments[0][i]=arguments[e][i]);return arguments[0]}};return{open:function(e){n.options=e,a.init()},close:function(e){a.close(e)}}}(window,document,document.documentElement);